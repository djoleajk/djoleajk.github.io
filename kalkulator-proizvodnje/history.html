<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å—Ç–æ—Ä–∏—ò–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò–∞</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container history-container">
        <a href="index.html" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –º–µ–Ω–∏</a>
        
        <h1>üìä –ò—Å—Ç–æ—Ä–∏—ò–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò–∞</h1>
        <p class="subtitle">–ü—Ä–µ–≥–ª–µ–¥ –ø–æ—Å–ª–µ–¥—ö–∏—Ö 100 –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò–∞</p>

        <!-- Statistika -->
        <div class="stats-section" id="statsSection">
            <div class="stat-card">
                <div class="stat-icon">üìù</div>
                <div class="stat-value" id="totalCalcs">0</div>
                <div class="stat-label">–£–∫—É–ø–Ω–æ –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-value" id="totalPieces">0</div>
                <div class="stat-label">–£–∫—É–ø–Ω–æ –∫–æ–º–∞–¥–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-value" id="totalTime">0h</div>
                <div class="stat-label">–£–∫—É–ø–Ω–æ –≤—Ä–µ–º–µ–Ω–∞</div>
            </div>
        </div>

        <!-- Filteri -->
        <div class="filters-section">
            <div class="filter-group">
                <label for="filterOperation">–§–∏–ª—Ç—Ä–∏—Ä–∞—ò –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—ò–∏:</label>
                <select id="filterOperation" class="filter-select">
                    <option value="all">–°–≤–µ –æ–ø–µ—Ä–∞—Ü–∏—ò–µ</option>
                    <option value="–£–±–∞–¥–∞—ö–µ">–£–±–∞–¥–∞—ö–µ</option>
                    <option value="–ó–∞—Ç–≤–∞—Ä–∞—ö–µ –ú–∏–Ω–µ">–ó–∞—Ç–≤–∞—Ä–∞—ö–µ –ú–∏–Ω–µ</option>
                    <option value="–ü–µ—Å–∫–∞—Ä–µ—ö–µ">–ü–µ—Å–∫–∞—Ä–µ—ö–µ</option>
                    <option value="–†–æ–±–æ—Ç">–†–æ–±–æ—Ç</option>
                    <option value="–ò—Ç–∞–ª–∏—ò–∞–Ω–∫–∞">–ò—Ç–∞–ª–∏—ò–∞–Ω–∫–∞</option>
                    <option value="–ë–ï–ú">–ë–ï–ú</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filterDate">–§–∏–ª—Ç—Ä–∏—Ä–∞—ò –ø–æ –¥–∞—Ç—É–º—É:</label>
                <input type="date" id="filterDate" class="filter-input">
            </div>

            <button id="clearFilters" class="btn-secondary">–û–±—Ä–∏—à–∏ —Ñ–∏–ª—Ç–µ—Ä–µ</button>
        </div>

        <!-- Akcije -->
        <div class="actions-section">
            <button id="exportJSON" class="btn-action">üì• –ò–∑–≤–µ–∑–∏ JSON</button>
            <button id="exportCSV" class="btn-action">üì• –ò–∑–≤–µ–∑–∏ CSV</button>
            <button id="clearHistory" class="btn-danger">üóëÔ∏è –û–±—Ä–∏—à–∏ –∏—Å—Ç–æ—Ä–∏—ò—É</button>
        </div>

        <!-- Lista istorije -->
        <div id="historyList" class="history-list">
            <div class="history-empty">
                <div class="empty-icon">üì≠</div>
                <p>–ù–µ–º–∞ —Å–∞—á—É–≤–∞–Ω–∏—Ö –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò–∞</p>
                <small>–ù–∞–ø—Ä–∞–≤–∏—Ç–µ –Ω–æ–≤—É –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò—É –¥–∞ –≤–∏–¥–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–µ –æ–≤–¥–µ</small>
            </div>
        </div>

        <div class="author-footer">
            <p>¬© 2025 ƒêorƒëe ≈Ωivanoviƒá</p>
        </div>
    </div>

    <script src="time-sync.js"></script>
    <script src="history-manager.js"></script>
    <script>
        // ============================================
        // PRIKAZ ISTORIJE
        // ============================================

        let currentFilter = {
            operation: 'all',
            date: null
        };

        // Uƒçitaj i prika≈æi istoriju
        function loadHistory() {
            const history = historyManager.getHistory();
            const filtered = filterHistory(history);
            displayHistory(filtered);
            updateStatistics();
        }

        // Filtriraj istoriju
        function filterHistory(history) {
            let filtered = history;

            // Filter po operaciji
            if (currentFilter.operation !== 'all') {
                filtered = filtered.filter(calc => calc.operation === currentFilter.operation);
            }

            // Filter po datumu
            if (currentFilter.date) {
                const targetDate = new Date(currentFilter.date).toLocaleDateString('sr-RS');
                filtered = filtered.filter(calc => {
                    const calcDate = new Date(calc.timestamp).toLocaleDateString('sr-RS');
                    return calcDate === targetDate;
                });
            }

            return filtered;
        }

        // Prika≈æi istoriju
        function displayHistory(history) {
            const historyList = document.getElementById('historyList');

            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="history-empty">
                        <div class="empty-icon">üì≠</div>
                        <p>–ù–µ–º–∞ –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò–∞ –∑–∞ –∏–∑–∞–±—Ä–∞–Ω–µ —Ñ–∏–ª—Ç–µ—Ä–µ</p>
                        <small>–ü–æ–∫—É—à–∞—ò—Ç–µ —Å–∞ –¥—Ä—É–≥–∏–º —Ñ–∏–ª—Ç–µ—Ä–∏–º–∞</small>
                    </div>
                `;
                return;
            }

            const html = history.map(calc => {
                const date = new Date(calc.timestamp);
                const dateStr = date.toLocaleDateString('sr-RS', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                const timeStr = date.toLocaleTimeString('sr-RS', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const operationIcon = getOperationIcon(calc.operation);
                const duration = historyManager.formatDuration(calc.totalDuration);

                return `
                    <div class="history-item" data-id="${calc.id}">
                        <div class="history-item-header">
                            <div class="history-item-title">
                                <span class="operation-icon">${operationIcon}</span>
                                <strong>${calc.operation}</strong>
                            </div>
                            <div class="history-item-date">
                                üìÖ ${dateStr} ‚Ä¢ ${timeStr}
                            </div>
                        </div>
                        <div class="history-item-body">
                            <div class="history-detail">
                                <span class="detail-label">–í—Ä–µ–º–µ –ø–æ –∫–æ–º–∞–¥—É:</span>
                                <span class="detail-value">${calc.timePerPiece} —Å–µ–∫</span>
                            </div>
                            <div class="history-detail">
                                <span class="detail-label">–ë—Ä–æ—ò –∫–æ–º–∞–¥–∞:</span>
                                <span class="detail-value">${calc.numberOfPieces} –∫–æ–º</span>
                            </div>
                            <div class="history-detail">
                                <span class="detail-label">–£–∫—É–ø–Ω–æ —Ç—Ä–∞—ò–∞—ö–µ:</span>
                                <span class="detail-value highlight">${duration}</span>
                            </div>
                            <div class="history-detail">
                                <span class="detail-label">–í—Ä–µ–º–µ:</span>
                                <span class="detail-value">${calc.startTime} ‚Üí ${calc.endTime}</span>
                            </div>
                            ${calc.note ? `
                            <div class="history-note">
                                <span class="note-icon">üìù</span>
                                <span>${calc.note}</span>
                            </div>
                            ` : ''}
                        </div>
                        <div class="history-item-actions">
                            <button class="btn-delete" onclick="deleteCalculation('${calc.id}')">üóëÔ∏è –û–±—Ä–∏—à–∏</button>
                        </div>
                    </div>
                `;
            }).join('');

            historyList.innerHTML = html;
        }

        // A≈æuriraj statistiku
        function updateStatistics() {
            const stats = historyManager.getStatistics();
            
            document.getElementById('totalCalcs').textContent = stats.totalCalculations;
            document.getElementById('totalPieces').textContent = stats.totalPieces.toLocaleString('sr-RS');
            
            const hours = Math.floor(stats.totalTime / 3600);
            const minutes = Math.floor((stats.totalTime % 3600) / 60);
            document.getElementById('totalTime').textContent = `${hours}h ${minutes}m`;
        }

        // Dobij ikonu operacije
        function getOperationIcon(operation) {
            const icons = {
                '–£–±–∞–¥–∞—ö–µ': 'üî®',
                '–ó–∞—Ç–≤–∞—Ä–∞—ö–µ –ú–∏–Ω–µ': 'üî©',
                '–ü–µ—Å–∫–∞—Ä–µ—ö–µ': 'üí®',
                '–†–æ–±–æ—Ç': 'ü§ñ',
                '–ò—Ç–∞–ª–∏—ò–∞–Ω–∫–∞': 'üáÆüáπ',
                '–ë–ï–ú': '‚öôÔ∏è'
            };
            return icons[operation] || 'üìä';
        }

        // Obri≈°i kalkulaciju
        function deleteCalculation(id) {
            if (confirm('–î–∞ –ª–∏ —Å—Ç–µ —Å–∏–≥—É—Ä–Ω–∏ –¥–∞ –∂–µ–ª–∏—Ç–µ –¥–∞ –æ–±—Ä–∏—à–µ—Ç–µ –æ–≤—É –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò—É?')) {
                historyManager.deleteCalculation(id);
                loadHistory();
            }
        }

        // Event listeners
        document.getElementById('filterOperation').addEventListener('change', (e) => {
            currentFilter.operation = e.target.value;
            loadHistory();
        });

        document.getElementById('filterDate').addEventListener('change', (e) => {
            currentFilter.date = e.target.value;
            loadHistory();
        });

        document.getElementById('clearFilters').addEventListener('click', () => {
            currentFilter = { operation: 'all', date: null };
            document.getElementById('filterOperation').value = 'all';
            document.getElementById('filterDate').value = '';
            loadHistory();
        });

        document.getElementById('exportJSON').addEventListener('click', () => {
            historyManager.exportToJSON();
        });

        document.getElementById('exportCSV').addEventListener('click', () => {
            historyManager.exportToCSV();
        });

        document.getElementById('clearHistory').addEventListener('click', () => {
            if (confirm('–î–∞ –ª–∏ —Å—Ç–µ —Å–∏–≥—É—Ä–Ω–∏ –¥–∞ –∂–µ–ª–∏—Ç–µ –¥–∞ –æ–±—Ä–∏—à–µ—Ç–µ –∫–æ–º–ø–ª–µ—Ç–Ω—É –∏—Å—Ç–æ—Ä–∏—ò—É?\n\n–û–≤–∞ –∞–∫—Ü–∏—ò–∞ —Å–µ –Ω–µ –º–æ–∂–µ –æ–ø–æ–∑–≤–∞—Ç–∏!')) {
                const confirmAgain = confirm('–ü–æ—Å–ª–µ–¥—ö–µ —É–ø–æ–∑–æ—Ä–µ—ö–µ: –°–≤–µ –∫–∞–ª–∫—É–ª–∞—Ü–∏—ò–µ —õ–µ –±–∏—Ç–∏ —Ç—Ä–∞—ò–Ω–æ –æ–±—Ä–∏—Å–∞–Ω–µ. –ù–∞—Å—Ç–∞–≤–∏?');
                if (confirmAgain) {
                    historyManager.clearHistory();
                    loadHistory();
                    alert('‚úì –ò—Å—Ç–æ—Ä–∏—ò–∞ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∏—Å–∞–Ω–∞');
                }
            }
        });

        // Inicijalno uƒçitavanje
        loadHistory();
    </script>
</body>
</html>

